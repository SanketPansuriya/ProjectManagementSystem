
<div class="container" style="width:2000px">
<h1>Tasks</h1>
<p style="color: green"><%= notice %></p>
<div class="btn" style="background-color: #b4b4b4">
<%= link_to "Add New Task", new_project_task_path if can? :new, Task %>
</div>

<br><br>
<table style="text-align: center; border: 1px solid black" frame="VOID" rules="ALL">
  <tr  style="background-color: #DCDCDC;">
    <th style="padding: 10px">Task Name</th>
    <th style="padding: 10px">Description</th>
    <th style="padding: 10px">Employee Name</th>
    <th style="padding: 10px">Employee Email</th>
    <th style="padding: 10px">status</th>
    
    <th style="padding: 10px"> Action </th>

    <th style="padding: 10px"> Hours </th>
    
    <th style="padding: 10px"> Change Task Status </th>  
  </tr>
  <% @tasks.each do |task| 
        employee = User.find(task.user_id)
  %>
  <tr style="background-color: #FFF0F5; padding:10px">
    <td>
      <%= task.title %>
      <%
        # params[:project_id] = task.sprint.project_id
        params[:task] = task.id
      %>
    </td>
     <td style="padding:10px">
      <%= task.description %>
    </td>
    <td style="padding:10px">
      <%= employee.name%>
    </td>
    <td style="padding:10px">
      <%= employee.email %>
    </td>
    <td style="padding:10px">
    <div id="status_<%=task.id%>">
      <%= task.status %>
      </div>
    </td>
    <td style="padding:10px">
     <span style="background-color: #DDA0DD; margin:5px;padding:5px; border-radius:5px">
      <%= link_to "View", project_task_path(id: task) if can? :show, task  %></span>
      <span style="background-color: #DDA0DD; margin:5px;padding:5px; border-radius:5px">
      <%= link_to "Edit", edit_project_task_path(id: task) if can? :edit, task %></span>
     <span style="background-color: #DDA0DD; margin:5px;padding:5px; border-radius:5px">
      <%= link_to "Delete", [task.sprint.project, task] , data: {
                    turbo_method: :delete,
                    turbo_confirm: "Are you sure?"
                  } if can? :destroy, task%></span>
    </td>
    <td >
      <div id="hours_<%=task.id%>"><%= @hours[task.id] %>
      </div>
    </td>
    <td >

      <%=select_tag(:status,options_for_select(@status.map {|row| row[0]},task.status),id:"select_id_#{task.id}",onchange: "changeStatus(#{task.id})") %>
    </td>
  </tr>
    
  <% end %>

</table>
</div>
<script>
// ajax method for change project status 
// change no of hours

function changeStatus(id) {
  select_id="#select_id_"+id;
  drop_option=$(select_id).find(":selected").text();
  
  $.ajax
  ({
    type: "patch",
    url: "/task/change_status",
    dataType: 'json',
    async: false,
    data: '{"id": "' + id + '", "status" : "' + drop_option + '"}',
    success: function (x){
      select_hours_id="#hours_"+id;
      $(select_hours_id).html(x["respons_message"])
      select_status_id="#status_"+id;
      $(select_status_id).html(drop_option)
 }
    
});
}
</script>